# λ°μ¤ν¬νƒ‘ GPU μ„λ²„ μΈν”„λΌ κµ¬μ΅° λ¬Έμ„

**μ‘μ„±μΌ**: 2025-11-18
**μ‘μ„±μ**: Bν€ Backend
**λ©μ **: λ‹¤μ μ„Έμ… Claudeκ°€ λ°μ¤ν¬νƒ‘ μΈν”„λΌλ¥Ό μ •ν™•ν μ΄ν•΄ν•λ„λ΅

---

## π–¥οΈ **μ „μ²΄ μΈν”„λΌ κµ¬μ΅°**

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  λ°μ¤ν¬νƒ‘ GPU μ„λ²„ (Windows 11)                              β”‚
β”‚  Tailscale IP: 100.120.180.42 (sweetlife)                  β”‚
β”‚  λλ”: 100.101.68.23 (desktop-ecmkau8)                     β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                            β”‚
        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
        β”‚                   β”‚                   β”‚
    β”β”€β”€β”€β–Όβ”€β”€β”€β”€β”        β”β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”        β”β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”
    β”‚Docker  β”‚        β”‚ Docker  β”‚        β”‚ComfyUI  β”‚
    β”‚Containerβ”‚       β”‚Containerβ”‚        β”‚(λ…λ¦½μ‹¤ν–‰)β”‚
    β”‚#1      β”‚        β”‚#2       β”‚        β”‚         β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    Ollama #1         Ollama #2          Port 8188
    Port 11434        Port 11435         (Docker X)
```

---

## π”§ **κ° κµ¬μ„± μ”μ† μƒμ„Έ**

### 1. Docker Container #1 (ollama-sparklio)

**μ»¨ν…μ΄λ„ μ΄λ¦„**: `ollama-sparklio`
**ν¬νΈ λ§¤ν•‘**: `11435:11434` (μ™Έλ¶€:λ‚΄λ¶€)
**μ‹¤μ  μ ‘μ† ν¬νΈ**: `11434` (Tailscale μ™Έλ¶€μ—μ„ μ ‘μ† μ‹)

**μ„¤μΉλ λ¨λΈ** (4κ°):
```
1. qwen2.5:7b       - μ£Όλ ¥ LLM λ¨λΈ
2. qwen2.5:14b      - κ³ μ„±λ¥ LLM λ¨λΈ
3. mistral-small    - 23.6B νλΌλ―Έν„° λ¨λΈ
4. llama3.2         - 3.2B κ²½λ‰ λ¨λΈ
```

**μ ‘μ† λ°©λ²•**:
```bash
# Tailscale λ„¤νΈμ›ν¬μ—μ„
curl http://100.120.180.42:11434/api/tags

# λ΅μ»¬μ—μ„
curl http://localhost:11434/api/tags
```

**μ©λ„**: **λ§¥λ―Έλ‹ Backendκ°€ μ΄ Ollamaλ¥Ό μ‚¬μ©**

---

### 2. Docker Container #2 (self-hosted-ai-s...)

**μ»¨ν…μ΄λ„ μ΄λ¦„**: `self-hosted-ai-s...` (μ „μ²΄ μ΄λ¦„ ν™•μΈ ν•„μ”)
**ν¬νΈ λ§¤ν•‘**: `11435:11434` λλ” λ‹¤λ¥Έ ν¬νΈ
**μ„¤μΉλ λ¨λΈ**: λ³„λ„λ΅ λ¶„λ¦¬λ μ¤ν”μ†μ¤ LLM λ¨λΈ

**μ ‘μ† λ°©λ²•**:
```bash
# Docker Desktopμ—μ„ ν¬νΈ ν™•μΈ ν›„
curl http://localhost:11435/api/tags
```

**μ©λ„**: Container #1κ³Ό λ³„λ„λ΅ κ΄€λ¦¬λλ” LLM λ¨λΈκµ°

---

### 3. ComfyUI (λ…λ¦½ μ‹¤ν–‰)

**μ‹¤ν–‰ λ°©μ‹**: **Docker μ»¨ν…μ΄λ„ μ•„λ‹, μ§μ ‘ Python μ‹¤ν–‰**
**ν¬νΈ**: `8188`
**κ²½λ΅**: `D:\AI\ComfyUI\`

**μ‹¤ν–‰ λ…λ Ήμ–΄**:
```bash
# PowerShellμ—μ„
cd D:\AI\ComfyUI
python main.py --listen 0.0.0.0 --port 8188
```

**μ ‘μ† λ°©λ²•**:
```bash
# μ›Ή λΈλΌμ°μ €
http://localhost:8188

# Tailscale λ„¤νΈμ›ν¬μ—μ„
http://100.120.180.42:8188
```

**μ¤‘μ”**:
- β οΈ ComfyUIλ” **μ λ€ Dockerλ΅ μ‹¤ν–‰ν•μ§€ μ•μ**
- μ»¤μ¤ν…€ λ…Έλ“, λ¨λΈ κ²½λ΅ λ¬Έμ λ΅ μ§μ ‘ μ‹¤ν–‰ ν•„μ”

**μ•λ ¤μ§„ μ—λ¬** (λ¬΄μ‹ κ°€λ¥):
```
ModuleNotFoundError: No module named 'cv2'
```
β†’ μΌλ¶€ μ»¤μ¤ν…€ λ…Έλ“μ—μ„ λ°μƒν•μ§€λ§ μ„λ²„λ” μ •μƒ μ‘λ™

---

## π **λ§¥λ―Έλ‹ Backend μ—°κ²° μ„¤μ •**

### `.env` νμΌ μ„¤μ • (λ§¥λ―Έλ‹)

**μ¬λ°”λ¥Έ μ„¤μ •**:
```bash
# Tailscale IP μ‚¬μ© (ν•„μ!)
OLLAMA_BASE_URL=http://100.120.180.42:11434
OLLAMA_TIMEOUT=120

# ComfyUI μ„¤μ •
COMFYUI_BASE_URL=http://100.120.180.42:8188
```

**β μλ»λ μ„¤μ •**:
```bash
# λ΅μ»¬ λ„¤νΈμ›ν¬ IP μ‚¬μ© (X)
OLLAMA_BASE_URL=http://192.168.0.100:11434  # β Tailscale λ°–μ—μ„ μ ‘μ† λ¶κ°€
```

---

## π”„ **λ‘ κ°μ Ollama μ»¨ν…μ΄λ„λ¥Ό λ¶„λ¦¬ν• μ΄μ **

### μ΄μ „ Claudeμ μ„¤κ³„ μλ„:

1. **λ¨λΈ κ²©λ¦¬**
   - Container #1: μƒμ©/ν”„λ΅λ•μ… λ¨λΈ
   - Container #2: μ‹¤ν—/κ°λ° λ¨λΈ

2. **λ¦¬μ†μ¤ κ΄€λ¦¬**
   - κ° μ»¨ν…μ΄λ„κ°€ λ³„λ„ GPU λ©”λ¨λ¦¬ μ‚¬μ©
   - ν• μ»¨ν…μ΄λ„ ν¬λμ‹ μ‹ λ‹¤λ¥Έ μ»¨ν…μ΄λ„ μν–¥ μ—†μ

3. **λ²„μ „ κ΄€λ¦¬**
   - λ‹¤λ¥Έ Ollama λ²„μ „ λ™μ‹ μ‹¤ν–‰ κ°€λ¥
   - A/B ν…μ¤νΈ μ©μ΄

### κ³µν†µ μ‚¬μ© κ°€λ¥:
- λ‘ μ»¨ν…μ΄λ„ λ¨λ‘ **κ°™μ€ Tailscale IP**λ΅ μ ‘κ·Ό
- ν¬νΈλ§ λ‹¤λ¥΄κ² μ„¤μ • (11434 vs 11435)

---

## π“‹ **μ κ²€ μ²΄ν¬λ¦¬μ¤νΈ**

### λ°μ¤ν¬νƒ‘μ—μ„ ν™•μΈν•  μ‚¬ν•­:

```bash
# 1. Docker μ»¨ν…μ΄λ„ μƒνƒ
docker ps

# 2. Ollama #1 μ‘λ™ ν™•μΈ
curl http://localhost:11434/api/tags

# 3. ComfyUI μ‘λ™ ν™•μΈ
curl http://localhost:8188

# 4. Tailscale IP ν™•μΈ
ipconfig | findstr "100.1"
```

### λ§¥λ―Έλ‹μ—μ„ ν™•μΈν•  μ‚¬ν•­:

```bash
# 1. .env μ„¤μ • ν™•μΈ
cat ~/sparklio_ai_marketing_studio/backend/.env | grep OLLAMA

# 2. Backend μ„λ²„ μƒνƒ
ps aux | grep uvicorn | grep -v grep

# 3. Ollama μ—°κ²° ν…μ¤νΈ
curl http://100.120.180.42:11434/api/tags

# 4. /generate API ν…μ¤νΈ
curl -X POST "http://localhost:8000/api/v1/generate" \
  -H "Content-Type: application/json" \
  -d '{"kind":"product_detail","brandId":"brand_demo","input":{"prompt":"ν…μ¤νΈ"},"options":{}}'
```

---

## π¨ **μμ£Ό λ°μƒν•λ” λ¬Έμ  & ν•΄κ²° λ°©λ²•**

### λ¬Έμ  1: "All connection attempts failed"

**μ›μΈ**: λ§¥λ―Έλ‹ `.env`κ°€ μλ»λ IP μ‚¬μ©

**ν•΄κ²°**:
```bash
# λ§¥λ―Έλ‹μ—μ„
cd ~/sparklio_ai_marketing_studio/backend
sed -i '' 's|OLLAMA_BASE_URL=http://192.168.0.100:11434|OLLAMA_BASE_URL=http://100.120.180.42:11434|g' .env

# Backend μ¬μ‹μ‘
pkill -f uvicorn
.venv/bin/uvicorn app.main:app --host 0.0.0.0 --port 8000 &
```

---

### λ¬Έμ  2: ComfyUI μ ‘μ† μ• λ¨

**μ›μΈ**: ComfyUIκ°€ Dockerμ—μ„ μ‹¤ν–‰ μ¤‘μ΄κ±°λ‚ μ¤‘μ§€λ¨

**ν•΄κ²°**:
```bash
# λ°μ¤ν¬νƒ‘μ—μ„
cd D:\AI\ComfyUI
python main.py --listen 0.0.0.0 --port 8188
```

---

### λ¬Έμ  3: Docker μ»¨ν…μ΄λ„κ°€ λ©μ¶¤

**ν™•μΈ**:
```bash
docker ps -a  # λ¨λ“  μ»¨ν…μ΄λ„ μƒνƒ
```

**μ¬μ‹μ‘**:
```bash
docker restart ollama-sparklio
```

---

## π“ **ν„μ¬ μ‘λ™ μƒνƒ (2025-11-18 ν™•μΈ)**

| κµ¬μ„±μ”μ† | μƒνƒ | ν¬νΈ | μ ‘μ† URL |
|---------|------|------|---------|
| Ollama Container #1 | β… μ‹¤ν–‰ μ¤‘ | 11434 | http://100.120.180.42:11434 |
| Ollama Container #2 | β… μ‹¤ν–‰ μ¤‘ | 11435 | http://100.120.180.42:11435 |
| ComfyUI | β… μ‹¤ν–‰ μ¤‘ | 8188 | http://100.120.180.42:8188 |
| Tailscale | β… μ—°κ²°λ¨ | - | sweetlife (100.120.180.42) |
| λ§¥λ―Έλ‹ Backend | β… μ •μƒ | 8000 | http://100.123.51.5:8000 |

---

## π” **λ³΄μ• & μ ‘κ·Ό μ μ–΄**

### Tailscale VPN:
- λ¨λ“  μ„λΉ„μ¤λ” **Tailscale λ„¤νΈμ›ν¬ λ‚΄μ—μ„λ§** μ ‘κ·Ό κ°€λ¥
- μ™Έλ¶€ μΈν„°λ„·μ—μ„ μ§μ ‘ μ ‘μ† λ¶κ°€
- μΈμ¦λ κΈ°κΈ°λ§ μ—°κ²° κ°€λ¥

### λ°©ν™”λ²½:
- ν¬νΈ 11434, 11435, 8188μ€ Tailscale μΈν„°νμ΄μ¤μ—λ§ κ°λ°©
- κ³µμ© μΈν„°λ„· μΈν„°νμ΄μ¤λ” μ°¨λ‹¨

---

## π“ **λ‹¤μ μ„Έμ… Claudeμ—κ²**

μ΄ λ¬Έμ„λ¥Ό μ½μΌλ©΄:
1. β… λ°μ¤ν¬νƒ‘μ— 2κ°μ Ollama μ»¨ν…μ΄λ„κ°€ μλ‹¤λ” κ²ƒμ„ μ• μ μμ
2. β… ComfyUIλ” Docker λ°–μ—μ„ μ‹¤ν–‰λλ‹¤λ” κ²ƒμ„ μ• μ μμ
3. β… λ§¥λ―Έλ‹ Backendκ°€ μ–΄λ Ollamaλ¥Ό μ‚¬μ©ν•λ”μ§€ μ• μ μμ
4. β… Tailscale IPλ¥Ό μ‚¬μ©ν•΄μ•Ό ν•λ‹¤λ” κ²ƒμ„ μ• μ μμ

**μ λ€ ν—·κ°λ¦¬μ§€ λ§μ„Έμ”!** π―

---

**λ¬Έμ„ λ²„μ „**: v1.0
**μµμΆ… μ—…λ°μ΄νΈ**: 2025-11-18 (ν™”) 11:56 (KST)
**λ‹¤μ μ—…λ°μ΄νΈ**: μΈν”„λΌ λ³€κ²½ μ‹
