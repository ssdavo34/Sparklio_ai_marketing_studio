---
doc_id: REQ-001-REPLY
title: B팀 LLM Gateway 작업 지시 (A팀 회신)
created: 2025-11-16
updated: 2025-11-16 16:00
status: approved
priority: P0
from: A팀 (QA & Testing)
to: B팀 (Backend 개발)
in_reply_to: B팀 완료 보고 (2025-11-16)
related:
  - REQ-001: B팀_LLM_GATEWAY_REQUEST
  - ARCH-002: Gateway Pattern
  - SPEC-001: LLM Gateway Spec
---

# B팀 작업 지시 회신

**발신**: A팀 (QA & Testing)
**수신**: B팀 (Backend 개발)
**회신일**: 2025-11-16 16:00
**회신 대상**: B팀 완료 보고 (2025-11-16)

---

## ✅ B팀 완료 작업 확인

훌륭합니다! 오늘 요청 사항 완료 감사합니다.

**확인된 작업**:
- ✅ 테스트 사용자 생성 스크립트
- ✅ Mac mini 서버 실행 성공
- ✅ 로그인 API 테스트 통과
- ✅ 문서 체계 검토 완료

**소요 시간**: 30분 (예상보다 빠름) 👍

---

## 🎯 B팀 질문에 대한 답변

### Q1: LLM Gateway 작업 시작 시점?

**A**: **즉시 시작 가능합니다** (2025-11-16 오후부터)

**이유**:
1. 문서 체계 검토 완료 ✅
2. 테스트 인프라 준비 완료 ✅
3. 우선순위: 🔴 최고 (테스트 타임아웃 해결 시급)

**시작 방법**:
```
1. [REQ-001: B팀 요청서](./BACKEND_LLM_GATEWAY_SUMMARY.md) 재확인 (3분)
2. [작업 지시서](./BACKEND_LLM_GATEWAY_WORK_ORDER.md) Phase 1 시작 (20분 읽기)
3. Phase 1-1 착수: LLM Gateway 디렉토리 구조 생성
```

---

### Q2: 기존 코드 리팩토링 vs 새로 작성?

**A**: **새로 작성 (Fresh Start)** 권장

**근거**:

#### 새로 작성해야 할 것:
```
backend/app/
├── api/v1/endpoints/
│   ├── llm_gateway.py          ← 🆕 새로 작성
│   └── media_gateway.py        ← 🆕 새로 작성
├── services/
│   ├── llm/                    ← 🆕 전체 새로 작성
│   │   ├── gateway.py
│   │   ├── router.py
│   │   └── providers/
│   │       ├── base.py
│   │       └── ollama.py
│   └── media/                  ← 🆕 전체 새로 작성
│       ├── gateway.py
│       └── providers/
│           ├── base.py
│           └── comfyui.py
```

**이유**:
1. Gateway 구조가 기존 코드와 다름
2. 깨끗한 설계부터 시작
3. 테스트 작성 용이
4. 나중에 기존 코드와 통합

#### 리팩터링할 것 (Phase 2):
```
backend/app/agents/
├── brief_agent.py              ← 🔄 Gateway Client 사용하도록 수정
├── brand_agent.py              ← 🔄 수정
├── strategist_agent.py         ← 🔄 수정
├── copywriter_agent.py         ← 🔄 수정
├── vision_generator_agent.py   ← 🔄 수정
└── reviewer_agent.py           ← 🔄 수정
```

**변경 패턴**:
```python
# Before (제거)
import ollama
response = ollama.generate(...)

# After (추가)
from app.services.clients.llm_client import LLMGatewayClient
llm_client = LLMGatewayClient()
response = await llm_client.generate(role="...", task="...", payload={...})
```

---

### Q3: Phase별 체크인 필요?

**A**: **네, 필요합니다** (Daily 체크인)

**체크인 일정**:

| Phase | 예상 기간 | 체크인 시점 | A팀 확인 사항 |
|-------|----------|------------|---------------|
| **Phase 1-1** | 0.5일 | 오늘 종료 시 (18:00) | 디렉토리 구조 생성 확인 |
| **Phase 1-2** | 1일 | 내일 종료 시 (18:00) | LLM Gateway Mock 동작 확인 |
| **Phase 1-3** | 1일 | 모레 종료 시 (18:00) | Ollama 연결 테스트 |
| **Phase 2** | 1.25일 | 매일 (18:00) | Agent 리팩터링 진행 상황 |
| **Phase 3** | 0.75일 | 매일 (18:00) | E2E 스크립트 작성 |

**체크인 방법**:
1. **간단 보고**: 슬랙 메시지 (3줄)
   ```
   Phase 1-1 완료:
   - ✅ 디렉토리 구조 생성
   - ✅ base.py Provider 인터페이스 정의
   - ⏳ 다음: LLM Gateway API 엔드포인트 구현
   ```

2. **상세 보고** (Phase 완료 시): `CURRENT_PHASE.md` 업데이트

3. **블로커 발생 시**: 즉시 A팀 호출

---

## 📋 오늘 작업 지시 (2025-11-16 오후)

### Phase 1-1: 디렉토리 구조 생성 (2-3시간)

**목표**: Gateway 기초 구조 완성

**작업 순서**:

#### 1. 디렉토리 생성
```bash
cd K:\sparklio_ai_marketing_studio\backend

mkdir -p app/api/v1/endpoints
mkdir -p app/services/llm/providers
mkdir -p app/services/media/providers
mkdir -p app/services/clients
```

#### 2. Provider 인터페이스 작성

**파일**: `app/services/llm/providers/base.py`
```python
from abc import ABC, abstractmethod
from typing import Dict, Any
from pydantic import BaseModel

class LLMProviderResponse(BaseModel):
    provider: str
    model: str
    usage: Dict[str, int]
    output: Dict[str, Any]
    meta: Dict[str, Any]

class LLMProvider(ABC):
    @property
    @abstractmethod
    def vendor(self) -> str:
        """Provider 벤더명: 'ollama' | 'openai' | 'anthropic'"""
        pass

    @property
    @abstractmethod
    def supports_json(self) -> bool:
        """JSON 모드 지원 여부"""
        pass

    @abstractmethod
    async def generate(
        self,
        prompt: str,
        role: str,
        task: str,
        mode: str,
        options: Dict[str, Any]
    ) -> LLMProviderResponse:
        """실제 LLM 호출"""
        pass
```

#### 3. 설정 파일 업데이트

**파일**: `app/core/config.py`
```python
# 추가
class Settings(BaseSettings):
    # 기존 설정...

    # Generator Mode
    GENERATOR_MODE: str = "mock"  # mock | live

    # LLM (Ollama)
    OLLAMA_BASE_URL: str = "http://100.120.180.42:11434"
    OLLAMA_TIMEOUT: int = 120

    # Media (ComfyUI)
    COMFYUI_BASE_URL: str = "http://100.120.180.42:8188"
    COMFYUI_TIMEOUT: int = 300
```

**파일**: `.env`
```env
# Generator Mode
GENERATOR_MODE=mock

# LLM (Ollama on Desktop)
OLLAMA_BASE_URL=http://100.120.180.42:11434
OLLAMA_TIMEOUT=120

# Media (ComfyUI on Desktop)
COMFYUI_BASE_URL=http://100.120.180.42:8188
COMFYUI_TIMEOUT=300
```

#### 4. 체크리스트

**오늘 완료 기준**:
- [ ] 디렉토리 구조 생성 완료
- [ ] `base.py` Provider 인터페이스 작성
- [ ] `config.py` 설정 추가
- [ ] `.env` 환경 변수 추가
- [ ] Git commit + push

**완료 보고**:
- 슬랙으로 간단 보고 (18:00까지)
- 블로커 있으면 즉시 공유

---

## 📅 주간 일정 (Week 1)

| 날짜 | 오전 (09:00-13:00) | 오후 (14:00-18:00) | 완료 기준 |
|------|-------------------|-------------------|----------|
| **2025-11-16 (토)** | - | Phase 1-1: 구조 생성 | 디렉토리 + 인터페이스 ✅ |
| **2025-11-17 (일)** | Phase 1-2: LLM Gateway API | Phase 1-2: Mock 응답 | Mock 모드 동작 ✅ |
| **2025-11-18 (월)** | Phase 1-3: Ollama Provider | Phase 1-3: 연결 테스트 | Live 모드 Ollama 연결 ✅ |
| **2025-11-19 (화)** | Phase 1-4: Media Gateway | Phase 2-1: Agent Client | Media Gateway 완성 ✅ |
| **2025-11-20 (수)** | Phase 2-2: Agent 리팩터링 | Phase 2-2: 리팩터링 계속 | 6개 Agent 완료 ✅ |
| **2025-11-21 (목)** | Phase 3: E2E 스크립트 | Phase 3: E2E 테스트 | E2E 성공 ✅ |
| **2025-11-22 (금)** | Phase 4: 테스트 정리 | 전체 검증 + 문서화 | 전체 완료 ✅ |

**주말 작업**:
- 토요일 오후: Phase 1-1 (2-3시간)
- 일요일 하루: Phase 1-2 (6-8시간)

---

## 🚨 중요 원칙 재확인

### ✅ 반드시 지킬 것

1. **Agent는 Gateway만 호출**
   - ❌ `import ollama` 금지
   - ✅ `LLMGatewayClient` 사용

2. **Mock/Live 모드 분리**
   - Mock: 빠른 테스트 (5초)
   - Live: 실제 품질 확인 (120초)

3. **Provider 패턴 엄수**
   - 모든 Provider는 `base.py` 인터페이스 구현
   - 새 Provider 추가 시 Gateway 코드 수정 불필요

4. **문서 업데이트**
   - Phase 완료 시 `CURRENT_PHASE.md` 업데이트
   - 블로커 발생 시 즉시 기록

### ❌ 절대 금지

1. **모델명 하드코딩**
   - ❌ `model="qwen2.5:14b"`
   - ✅ Router가 자동 선택

2. **직접 Ollama/ComfyUI 호출**
   - ❌ `ollama.generate(...)`
   - ✅ `llm_gateway.generate(...)`

3. **Gateway 없이 Agent 수정**
   - Phase 1 완료 전에는 Agent 수정 금지
   - Phase 2에서 체계적으로 리팩터링

---

## 📞 연락 방법

### 일반 문의
- **슬랙**: #sparklio-backend 채널
- **응답 시간**: 30분 이내

### 긴급 문의
- **A팀 직접 호출**
- **블로커**: 즉시 공유 필요

### Daily 체크인
- **시간**: 매일 18:00
- **방법**: 슬랙 간단 보고 (3줄)
- **형식**:
  ```
  Phase X 진행 상황:
  - ✅ 완료: ...
  - 🔄 진행 중: ...
  - ⏳ 다음: ...
  ```

---

## 🎯 오늘의 성공 지표

**18:00까지 완료 목표**:
- [x] 디렉토리 구조 생성
- [x] Provider 인터페이스 작성
- [x] 설정 파일 업데이트
- [x] Git commit + push
- [x] A팀에게 완료 보고

**내일 준비**:
- [ ] [작업 지시서](./BACKEND_LLM_GATEWAY_WORK_ORDER.md) Phase 1-2 정독
- [ ] [SPEC-001: LLM Gateway Spec](../specs/LLM_GATEWAY_SPEC_v1.0.md) API Contract 확인

---

## ✅ 최종 확인

B팀이 즉시 시작할 수 있도록:

**읽을 문서 (우선순위)**:
1. ✅ 이 회신 문서 (지금 읽는 중)
2. ⏭️ [작업 지시서 Phase 1-1](./BACKEND_LLM_GATEWAY_WORK_ORDER.md#phase-1-gateway-기초-구축)
3. ⏭️ [SPEC-001: LLM Gateway Spec](../specs/LLM_GATEWAY_SPEC_v1.0.md) (필요 시)

**작업 시작**:
```bash
# 1. 최신 코드 pull
git pull origin master

# 2. 새 브랜치 생성
git checkout -b feature/llm-gateway-phase1

# 3. 작업 시작
cd backend/app
mkdir -p api/v1/endpoints services/llm/providers ...
```

**질문 있으면**: 즉시 슬랙으로 문의하세요!

---

**발신**: A팀 (QA & Testing)
**발신일**: 2025-11-16 16:00
**수신**: B팀 (Backend 개발)

**기대**: 오늘 18:00까지 Phase 1-1 완료 보고 🚀
